<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Ethan Chen - Photography</title>
    <link rel="stylesheet" href="https://latex.vercel.app/style.css">
    <link rel="icon" href="./favicon.ico" type="image/x-icon">
    <!-- EXIF Reader Library -->
    <script src="https://cdn.jsdelivr.net/npm/exif-js"></script>
    <style>
      body.lightbox-open { overflow: hidden; }
      .photo-gallery {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        opacity: 0;
        transition: opacity 0.6s ease-in-out;
      }
      .photo-row {
        display: flex;
        gap: 1rem;
      }
      .photo-row.is-centered {
        justify-content: center;
      }
      .photo-row a {
        line-height: 0;
        cursor: pointer;
        overflow: hidden;
        border-radius: 8px;
      }
      .photo-row img {
        /* No width/height here. JS will set it directly. */
        display: block; /* Treat image as a block to avoid weird inline spacing. */
        transition: transform 0.3s ease, filter 0.3s ease;
      }
      .photo-row a:hover img {
        transform: scale(1.02);
        filter: brightness(0.9);
      }
      .loading-placeholder { min-height: 60vh; display: flex; justify-content: center; align-items: center; font-style: italic; color: #888; }
      /* Lightbox styles */
      .lightbox { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.92); justify-content: center; align-items: center; }
      .lightbox-content { position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center; }
      .lightbox-content img { max-width: 90vw; max-height: 85vh; object-fit: contain; border-radius: 4px; }
      .lightbox-caption { color: #ccc; margin-top: 1rem; font-family: monospace; text-align: center; font-size: 0.9em; }
      .close-lightbox { position: absolute; top: 15px; right: 35px; color: #f1f1f1; font-size: 40px; font-weight: bold; cursor: pointer; transition: color 0.2s; }
      .close-lightbox:hover { color: #ccc; }
    </style>
  </head>
  <body>
    <main>
      <p><a href="/">Back to home</a></p>
      <h1>Photography</h1>
      <p>A selection of my favorite shots. More on <a href="https://www.instagram.com/notaprimelens/" target="_blank">Instagram</a>.</p>
      
      <div class="photo-gallery" id="photo-gallery">
        <div class="loading-placeholder">Loading gallery...</div>
      </div>

      <p><a href="/">Back to home</a></p>
    </main>

    <div id="lightbox" class="lightbox">
      <span class="close-lightbox" id="close-lightbox">&times;</span>
      <div class="lightbox-content">
        <img id="lightbox-img">
        <div id="lightbox-caption" class="lightbox-caption"></div>
      </div>
    </div>

    <footer>
      <p>&copy; 2025 Ethan Chen. All rights reserved.</p>
      <p>Powered by <a href="https://latex.vercel.app/" target="_blank">LaTeX.css</a></p>
    </footer>

    <script>
      document.addEventListener('DOMContentLoaded', async function() {
        const photoSources = [
          { src: 'photography/korean-temple-roof.jpg', alt: 'Symmetrical view of a traditional Korean temple roof' },
          { src: 'photography/reclining-buddha-fukuoka.jpg', alt: 'A large, golden reclining Buddha statue seen through prayer slips' },
          { src: 'photography/photographer-byodo-in.jpg', alt: 'A photographer shooting the Byodo-in Temple in Japan' },
          { src: 'photography/iidabashi-station-arches.jpg', alt: 'Concrete arches inside Iidabashi Station in Tokyo' },
          { src: 'photography/rider-by-the-sea.jpg', alt: 'A person and a motorcycle by the sea' },
          { src: 'photography/tokyo-tower-framed.jpg', alt: 'Tokyo Tower framed by a narrow staircase' }
        ];

        const gallery = document.getElementById('photo-gallery');
        const lightbox = document.getElementById('lightbox');
        const lightboxImg = document.getElementById('lightbox-img');
        const lightboxCaption = document.getElementById('lightbox-caption');
        const closeBtn = document.getElementById('close-lightbox');
        
        async function getExifData(img) {
          return new Promise(resolve => {
            EXIF.getData(img, function() {
              const allTags = EXIF.getAllTags(this);
              resolve({
                camera: allTags.Make && allTags.Model ? `${allTags.Make} ${allTags.Model}`.trim() : 'Unknown Camera',
                lens: allTags.LensModel || allTags.LensInfo || 'Unknown Lens',
                focalLength: allTags.FocalLength ? `${allTags.FocalLength}mm` : '',
                shutterSpeed: allTags.ExposureTime ? (allTags.ExposureTime < 1 ? `1/${Math.round(1/allTags.ExposureTime)}s` : `${allTags.ExposureTime}s`) : '',
                aperture: allTags.FNumber ? `f/${allTags.FNumber}` : '',
                iso: allTags.ISOSpeedRatings ? `ISO ${allTags.ISOSpeedRatings}` : ''
              });
            });
          });
        }

        async function createRuleBasedLayout() {
          gallery.innerHTML = '<div class="loading-placeholder">Curating layout...</div>';
          
          // Use more precise measurements to avoid rounding errors that cause stretching.
          const containerWidth = gallery.getBoundingClientRect().width;
          const gap = parseFloat(getComputedStyle(document.documentElement).fontSize); // Calculate 1rem gap in px

          const photosWithData = await Promise.all(photoSources.map(p => 
            new Promise(async (resolve, reject) => {
              const img = new Image();
              img.onload = async () => {
                const exif = await getExifData(img);
                resolve({ ...p, ...exif, ratio: img.width / img.height });
              };
              img.onerror = reject;
              img.src = p.src;
            })
          ));

          gallery.innerHTML = '';
          
          let i = 0;
          while (i < photosWithData.length) {
            const rowDiv = document.createElement('div');
            rowDiv.className = 'photo-row';
            
            const photo1 = photosWithData[i];
            
            // Rule 1: Panoramic images get their own row.
            if (photo1.ratio > 2.2) {
              const rowHeight = containerWidth / photo1.ratio;
              const link = document.createElement('a');
              link.onclick = () => openLightbox(photo1);
              const imgEl = document.createElement('img');
              imgEl.src = photo1.src;
              imgEl.alt = photo1.alt;
              imgEl.style.height = `${rowHeight}px`;
              imgEl.style.width = `${containerWidth}px`;
              link.appendChild(imgEl);
              rowDiv.appendChild(link);
              gallery.appendChild(rowDiv);
              i += 1;
              continue;
            }
            
            const photo2 = photosWithData[i + 1];
            
            // Rule 2: Create rows of two if a second photo exists.
            if (photo2) {
              const photosInRow = [photo1, photo2];
              const totalRatio = photosInRow.reduce((acc, p) => acc + p.ratio, 0);
              const rowHeight = (containerWidth - gap) / totalRatio;
              
              photosInRow.forEach(p => {
                const link = document.createElement('a');
                link.onclick = () => openLightbox(p);
                const imgEl = document.createElement('img');
                imgEl.src = p.src;
                imgEl.alt = p.alt;
                imgEl.style.height = `${rowHeight}px`;
                imgEl.style.width = `${p.ratio * rowHeight}px`;
                link.appendChild(imgEl);
                rowDiv.appendChild(link);
              });
              gallery.appendChild(rowDiv);
              i += 2;
            
            // Rule 3: Handle a single, non-panoramic image at the end.
            } else {
              rowDiv.classList.add('is-centered');
              const idealHeight = 450; // A good max height for a single image
              const link = document.createElement('a');
              link.onclick = () => openLightbox(photo1);
              const imgEl = document.createElement('img');
              imgEl.src = photo1.src;
              imgEl.alt = photo1.alt;
              imgEl.style.height = `${idealHeight}px`;
              imgEl.style.width = `${photo1.ratio * idealHeight}px`;
              link.appendChild(imgEl);
              rowDiv.appendChild(link);
              gallery.appendChild(rowDiv);
              i += 1;
            }
          }
          gallery.style.opacity = 1;
        }

        function openLightbox(photo) {
          const captionParts = [photo.camera, photo.lens, photo.focalLength, photo.shutterSpeed, photo.aperture, photo.iso].filter(Boolean);
          lightboxCaption.textContent = captionParts.join(' | ');
          lightboxImg.src = photo.src;
          lightbox.style.display = 'flex';
          document.body.classList.add('lightbox-open');
        }

        function closeLightbox() {
          lightbox.style.display = 'none';
          document.body.classList.remove('lightbox-open');
        }

        await createRuleBasedLayout();
        closeBtn.addEventListener('click', closeLightbox);
        lightbox.addEventListener('click', (e) => { if (e.target === lightbox) closeLightbox(); });

        let resizeTimer;
        window.addEventListener('resize', () => {
          clearTimeout(resizeTimer);
          resizeTimer = setTimeout(createRuleBasedLayout, 150);
        });
      });
    </script>
  </body>
</html> 